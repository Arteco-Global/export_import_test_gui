<!doctype html>
<html lang="it">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Import / Export GUI</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <main class="app">
      <header class="header">
        <h1>Import / Export</h1>
        <p>GUI minimale per scaricare l'export o aggiornare un config.json.</p>
      </header>

      <section class="card" id="loginSection">
        <h2>Base URL</h2>
        <div class="field">
          <label for="baseUrl">Base URL</label>
          <input id="baseUrl" type="text" placeholder="https://localhost" value="https://localhost" />
        </div>
        <div class="grid">
          <div class="field">
            <label for="username">Username</label>
            <input id="username" type="text" placeholder="admin" value="admin" />
          </div>
          <div class="field">
            <label for="password">Password</label>
            <input id="password" type="password" placeholder="••••••" value="admin" />
          </div>
        </div>
        <div class="field">
          <label for="authServiceSelect">Auth service</label>
          <select id="authServiceSelect" disabled>
            <option value="">Carica gli auth service</option>
          </select>
        </div>
        <div class="grid">
          <button id="loginBtn" class="primary" disabled>Login</button>
        </div>
        <div id="loginSpinner" class="login-spinner hidden">
          <div class="spinner" aria-hidden="true"></div>
          <div>Login in corso...</div>
        </div>
        <div class="status" id="loginStatus"></div>
        <div class="hint" id="baseUrlHint">
          Login obbligatorio: il token ottenuto viene usato per reset, mapping, import ed export.
        </div>
      </section>

      <section class="card hidden" id="exportSection">
        <h2>Export</h2>
        <p>Scarica l'export da <span class="mono">/api/v2/export</span> e salvalo dove vuoi.</p>
        <button id="exportBtn" class="primary" disabled>Scarica export</button>
        <div class="status" id="exportStatus"></div>
      </section>

      <section class="card hidden" id="backupsSection">
        <h2>Backups</h2>
        <p>Elenco dei backup presenti su <span class="mono">/api/v2/backups</span>.</p>
        <div class="backups-actions">
          <button id="refreshBackupsBtn" class="primary" disabled>Ricarica lista</button>
        </div>
        <details id="backupsAccordion" class="backups-accordion">
          <summary>
            Backup disponibili
            <span id="backupsSummaryCount" class="backups-count">0</span>
          </summary>
          <div id="backupsList" class="backups-list">
            <div class="placeholder">Login per vedere i backup disponibili.</div>
          </div>
        </details>
        <div class="status" id="backupsStatus"></div>
      </section>

      <section class="card hidden" id="resetSection">
        <h2>Reset server</h2>
        <p>Ripristina il server allo stato iniziale</p>
        <div class="field">
          <label for="resetSecret">Reset secret</label>
          <input id="resetSecret" type="password" placeholder="HYPERNODE_RESET_6A9K3M2QX7" value="HYPERNODE_RESET_6A9K3M2QX7" />
        </div>
        <button id="resetBtn" class="primary">Reset server</button>
        <div class="status" id="resetStatus"></div>
      </section>

      <section class="card hidden" id="importSection">
        <h2>Import</h2>
        <p>Carica il <span class="mono">config.json</span> con chiavi <span class="mono">CHANNELS</span> e <span class="mono">MAPPING</span>. Puoi attivare o disattivare <span class="mono">SNAPSHOTS</span>, <span class="mono">RECORDINGS</span>, <span class="mono">EVENTS</span> e le altre sezioni disponibili.</p>
        <div class="field">
          <label for="configFile">config.json (vecchio server)</label>
          <input id="configFile" type="file" accept="application/json" />
        </div>

        <div id="importLoading" class="import-loading hidden">
          <div class="spinner" aria-hidden="true"></div>
          <div>Caricamento mapping...</div>
        </div>

        <div id="importBody">
          <div class="associations">
            <h3>Associazioni servizi</h3>
            <h5>Servizio Precedente -> Nuovo servizio</h5>
          <div class="import-keys">
            <h4>Chiavi da importare</h4>
            <div id="importKeyList" class="import-key-list">
              <div class="placeholder">Carica un config.json per selezionare le chiavi.</div>
            </div>
          </div>
          <div id="associationList" class="association-list">
            <div class="placeholder">Carica entrambi i mapping per vedere le associazioni.</div>
          </div>
          </div>

          <button id="importBtn" class="primary" disabled>Invia import</button>
          <div class="status" id="importStatus"></div>
        </div>
      </section>
    </main>

    <script src="app.js"></script>
  </body>
</html>
